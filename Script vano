local Compkiller = loadstring(game:HttpGet("https://raw.githubusercontent.com/4lpaca-pin/CompKiller/refs/heads/main/src/source.luau"))();

local UserInputService = game:GetService("UserInputService")
local Players = game:GetService("Players")
local InfiniteJumpEnabled = false
local SpeedEnabled = false 

UserInputService.JumpRequest:Connect(function()
	if InfiniteJumpEnabled then
		local Character = Players.LocalPlayer.Character
		local Humanoid = Character and Character:FindFirstChildOfClass('Humanoid')
		
		if Humanoid then
			Humanoid:ChangeState(Enum.HumanoidStateType.Jumping)
		end
	end
end)

local Notifier = Compkiller.newNotify();

Compkiller:Loader("rbxassetid://72788619889737" , 2.5).yield();

local Window = Compkiller.new({
	Name = "VANO-HUB",
	Keybind = "LeftAlt",
	Logo = "rbxassetid://72788619889737",
	Scale = Compkiller.Scale.Window,
	TextSize = 15,
});

Notifier.new({
	Title = "Welcome",
	Content = "Welcome rshome",
	Duration = 10,
	Icon = "rbxassetid://72788619889737"
});

local Watermark = Window:Watermark();

Watermark:AddText({
	Icon = "user",
	Text = "RShome",
});

Watermark:AddText({
	Icon = "clock",
	Text = Compkiller:GetDate(),
});

local Time = Watermark:AddText({
	Icon = "timer",
	Text = "TIME",
});

task.spawn(function()
	while true do task.wait()
		Time:SetText(Compkiller:GetTimeNow());
	end
end)

Watermark:AddText({
	Icon = "server",
	Text = Compkiller.Version,
});

Window:DrawCategory({
	Name = "Example"
});

local NormalTab = Window:DrawTab({
	Name = "Main",
	Icon = "sword",
	EnableScrolling = true
});

local NormalSection = NormalTab:DrawSection({
	Name = "Section (Left)",
	Position = 'left'	
});

NormalSection:AddToggle({
	Name = "Infinite Jump",
	Default = false,
	Callback = function(v)
		InfiniteJumpEnabled = v
	end,
});

local SpeedSlider
NormalSection:AddToggle({
	Name = "Speed",
	Default = false,
	Callback = function(v)
		SpeedEnabled = v
		
		local Player = Players.LocalPlayer
		local Humanoid = Player and Player.Character and Player.Character:FindFirstChildOfClass('Humanoid')
		
		if Humanoid then
			local targetSpeed = v and SpeedSlider:GetValue() or 16
			sethiddenproperty(Humanoid, "WalkSpeed", targetSpeed)
		end
	end,
});

SpeedSlider = NormalSection:AddSlider({
	Name = "WalkSpeed Value",
	Min = 16,
	Max = 300,
	Default = 50, 
	Step = 1,
	Unit = "WalkSpeed",
	Callback = function(v)
		if SpeedEnabled then
			local Player = Players.LocalPlayer
			local Humanoid = Player and Player.Character and Player.Character:FindFirstChildOfClass('Humanoid')
			
			if Humanoid then
				sethiddenproperty(Humanoid, "WalkSpeed", v)
			end
		end
	end
});

NormalSection:AddButton({
	Name = "Fly V3 (Open GUI)",
	Callback = function()
		local main = game.Players.LocalPlayer.PlayerGui:FindFirstChild("main")
		if main then
			main:Destroy()
			Notifier.new({
				Title = "Fly V3",
				Content = "Fly GUI was closed.",
				Duration = 3,
				Icon = "rbxassetid://72788619889737"
			})
			return
		end
		
		Notifier.new({
			Title = "Fly V3",
			Content = "Fly GUI was activated. Look for the window.",
			Duration = 5,
			Icon = "rbxassetid://72788619889737"
		})
	end,
});


local NormalSectionRight = NormalTab:DrawSection({
	Name = "Visual",
	Position = 'right'
});

-- == ESP FUNCTIONALITY START ==
local espConnections = {}
local espRun = nil
local Holder = nil
local HealthBarEnabled = false -- НОВАЯ ПЕРЕМЕННАЯ ДЛЯ ЗДОРОВЬЯ

NormalSectionRight:AddToggle({
	Name = "ESP",
	Default = false,
	Callback = function(v)
		if v then
			_G.FriendColor = Color3.fromRGB(0, 0, 255)
			_G.EnemyColor = Color3.fromRGB(255, 0, 0)
			_G.UseTeamColor = true

			Holder = Instance.new("Folder")
			Holder.Name = "VANO_ESP_Holder"
			Holder.Parent = game.CoreGui
			
			local Box = Instance.new("BoxHandleAdornment")
			Box.Name = "nilBox"
			Box.Size = Vector3.new(1, 2, 1)
			Box.Color3 = Color3.new(100 / 255, 100 / 255, 100 / 255)
			Box.Transparency = 0.7
			Box.ZIndex = 0
			Box.AlwaysOnTop = false
			Box.Visible = false

			local NameTag = Instance.new("BillboardGui")
			NameTag.Name = "nilNameTag"
			NameTag.Enabled = false
			NameTag.Size = UDim2.new(0, 200, 0, 50)
			NameTag.AlwaysOnTop = true
			NameTag.StudsOffset = Vector3.new(0, 1.8, 0)
			local Tag = Instance.new("TextLabel", NameTag)
			Tag.Name = "Tag"
			Tag.BackgroundTransparency = 1
			Tag.Position = UDim2.new(0, -50, 0, 0)
			Tag.Size = UDim2.new(0, 300, 0, 20)
			Tag.TextSize = 15
			Tag.TextColor3 = Color3.new(100 / 255, 100 / 255, 100 / 255)
			Tag.TextStrokeColor3 = Color3.new(0 / 255, 0 / 255, 0 / 255)
			Tag.TextStrokeTransparency = 0.4
			Tag.Text = "nil"
			Tag.Font = Enum.Font.SourceSansBold
			Tag.TextScaled = false

			-- НОВЫЕ ЭЛЕМЕНТЫ ДЛЯ ЗДОРОВЬЯ (КЛОНИРУЕМЫЙ ОБРАЗЕЦ)
			local HealthTagTemplate = Instance.new("BillboardGui")
			HealthTagTemplate.Name = "nilHealthTag"
			HealthTagTemplate.Enabled = false
			HealthTagTemplate.Size = UDim2.new(0, 100, 0, 20)
			HealthTagTemplate.AlwaysOnTop = true
			HealthTagTemplate.StudsOffset = Vector3.new(0, 2.3, 0) 
			local HealthTextTemplate = Instance.new("TextLabel", HealthTagTemplate)
			HealthTextTemplate.Name = "HealthText"
			HealthTextTemplate.BackgroundTransparency = 1
			HealthTextTemplate.Size = UDim2.new(1, 0, 1, 0)
			HealthTextTemplate.TextSize = 14
			HealthTextTemplate.TextColor3 = Color3.fromRGB(0, 255, 0)
			HealthTextTemplate.TextStrokeTransparency = 0.5
			HealthTextTemplate.Text = "HP: 100"
			HealthTextTemplate.Font = Enum.Font.SourceSansBold
			-- КОНЕЦ НОВЫХ ЭЛЕМЕНТОВ ДЛЯ ЗДОРОВЬЯ

			local function UnloadCharacter(v)
				local vHolder = Holder:FindFirstChild(v.Name)
				if vHolder then
					vHolder:ClearAllChildren()
				end
			end
			
			local function LoadCharacter(v)
				repeat task.wait() until v.Character
				local Humanoid = v.Character:FindFirstChild("Humanoid")
				if not Humanoid then return UnloadCharacter(v) end
				
				local vHolder = Holder:FindFirstChild(v.Name) or Instance.new("Folder", Holder)
				vHolder.Name = v.Name
				vHolder:ClearAllChildren()
				
				local char = v.Character
				
				local b = Box:Clone()
				b.Name = v.Name .. "Box"
				b.Adornee = char
				b.Parent = vHolder
				
				local t = NameTag:Clone()
				t.Name = v.Name .. "NameTag"
				t.Enabled = true
				t.Parent = vHolder
				t.Adornee = char:WaitForChild("Head", 5)
				if not t.Adornee then
					return UnloadCharacter(v)
				end
				
				t.Tag.Text = v.Name
				b.Color3 = v.TeamColor.Color
				t.Tag.TextColor3 = v.TeamColor.Color

				-- СОЗДАНИЕ МЕТКИ ЗДОРОВЬЯ
				local HealthTag = HealthTagTemplate:Clone()
				HealthTag.Name = v.Name .. "HealthTag"
				HealthTag.Enabled = HealthBarEnabled -- Управляется новым тогглом
				HealthTag.Parent = vHolder
				HealthTag.Adornee = t.Adornee
				local HealthText = HealthTag:FindFirstChild("HealthText")
				
				local Update = nil
				local function UpdateNameTag()
					if not char or not char:FindFirstChild("Humanoid") then
						if Update then Update:Disconnect() end
						return UnloadCharacter(v)
					end
					
					-- ЛОГИКА ОБНОВЛЕНИЯ ЗДОРОВЬЯ
					local currentHealth = math.ceil(Humanoid.Health)
					local maxHealth = Humanoid.MaxHealth

					if HealthText then
						HealthText.Text = "HP: " .. currentHealth
						
						-- Изменение цвета в зависимости от здоровья
						if currentHealth < maxHealth / 4 then
							HealthText.TextColor3 = Color3.fromRGB(255, 0, 0) -- Красный
						elseif currentHealth < maxHealth / 2 then
							HealthText.TextColor3 = Color3.fromRGB(255, 255, 0) -- Желтый
						else
							HealthText.TextColor3 = Color3.fromRGB(0, 255, 0) -- Зеленый
						end
					end
					
					Humanoid.DisplayDistanceType = Enum.HumanoidDisplayDistanceType.None
				end
				
				Update = Humanoid.Changed:Connect(UpdateNameTag)
				if espConnections[v.Name] then espConnections[v.Name]:Disconnect() end
				espConnections[v.Name] = Update
				UpdateNameTag() -- Первоначальный вызов
			end

			local function LoadPlayer(v)
				local vHolder = Holder:FindFirstChild(v.Name) or Instance.new("Folder", Holder)
				vHolder.Name = v.Name

				espConnections[v.Name .. "CharAdded"] = v.CharacterAdded:Connect(function() pcall(LoadCharacter, v) end)
				espConnections[v.Name .. "CharRemoving"] = v.CharacterRemoving:Connect(function() pcall(UnloadCharacter, v) end)
				espConnections[v.Name .. "TeamChanged"] = v.Changed:Connect(function(prop)
					if prop == "TeamColor" then
						UnloadCharacter(v)
						task.wait()
						LoadCharacter(v)
					end
				end)
				LoadCharacter(v)
			end

			local function UnloadPlayer(v)
				UnloadCharacter(v)
				local vHolder = Holder:FindFirstChild(v.Name)
				if vHolder then
					vHolder:Destroy()
				end
				for k, conn in pairs(espConnections) do
					if k:match(v.Name) then
						conn:Disconnect()
						espConnections[k] = nil
					end
				end
			end
			
			for _, p in Players:GetPlayers() do
				if p ~= Players.LocalPlayer then
					task.spawn(function() pcall(LoadPlayer, p) end)
				end
			end

			espConnections["PlayerAdded"] = Players.PlayerAdded:Connect(function(p)
				if p ~= Players.LocalPlayer then
					pcall(LoadPlayer, p)
				end
			end)
			
			espConnections["PlayerRemoving"] = Players.PlayerRemoving:Connect(UnloadPlayer)
			
			Players.LocalPlayer.NameDisplayDistance = 0

			local function highlightEsp(target, color)
				if target.Character then
					if not target.Character:FindFirstChild("VANO_Highlight") then
						local highlight = Instance.new("Highlight")
						highlight.RobloxLocked = true
						highlight.Name = "VANO_Highlight"
						highlight.Adornee = target.Character
						highlight.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop
						highlight.FillColor = color
						highlight.Parent = target.Character
					else
						target.Character.VANO_Highlight.FillColor = color
					end
				end
			end
			
			espRun = task.spawn(function()
				while task.wait() and v do 
					local plr = Players.LocalPlayer
					for _, p in Players:GetPlayers() do
						if p ~= plr then
							local color = _G.UseTeamColor and p.TeamColor.Color or ((plr.TeamColor == p.TeamColor) and _G.FriendColor or _G.EnemyColor)
							highlightEsp(p, color)
						end
					end
				end
			end)
			
		else
			if espRun then
				task.cancel(espRun)
				espRun = nil
			end
			
			for _, conn in pairs(espConnections) do
				conn:Disconnect()
			end
			espConnections = {}
			
			if Holder then
				Holder:Destroy()
				Holder = nil
			end

			for _, obj in ipairs(game.Workspace:GetDescendants()) do
				if obj.Name == "VANO_Highlight" and obj:IsA("Highlight") then
					obj:Destroy()
				end
			end
		end
	end,
});

-- НОВЫЙ TOGGLE ДЛЯ ЗДОРОВЬЯ
NormalSectionRight:AddToggle({
	Name = "Health Bar",
	Default = false,
	Callback = function(v)
		HealthBarEnabled = v
		
		-- Обновляем видимость HealthTag для всех существующих игроков
		for _, p in Players:GetPlayers() do
			if p ~= Players.LocalPlayer and p.Character then
				local vHolder = Holder and Holder:FindFirstChild(p.Name)
				if vHolder then
					local HealthTag = vHolder:FindFirstChild(p.Name .. "HealthTag")
					if HealthTag and HealthTag:IsA("BillboardGui") then
						HealthTag.Enabled = v
					end
				end
			end
		end
	end,
});
-- == ESP FUNCTIONALITY END ==


local SingleTab = Window:DrawTab({
	Name = "General Tab",
	Icon = "fire",
	Type = "Single"
});

local GeneralSection = SingleTab:DrawSection({
	Name = "TP Player",
	Position = 'left'
});

local PlayerListDropdown = nil
local CurrentTarget = nil
local CurrentTweenSpeed = 0.16 

GeneralSection:AddSlider({
	Name = "TP Tween Speed",
	Min = 10,
	Max = 100,
	Default = 50, 
	Step = 1,
	Unit = "Speed",
	Callback = function(v)
		-- Time = 8 / V. (100 = 0.08s, 10 = 0.8s)
		CurrentTweenSpeed = 8 / v
	end
});


local function UpdatePlayers()
	local playerNames = {}
	for _, player in Players:GetPlayers() do
		if player ~= Players.LocalPlayer then
			table.insert(playerNames, player.Name)
		end
	end
	
	if #playerNames == 0 then
		table.insert(playerNames, "No players found")
	end
	
	if PlayerListDropdown then
		PlayerListDropdown:SetValues(playerNames)
		CurrentTarget = playerNames[1]
	end
	
	return playerNames
end

PlayerListDropdown = GeneralSection:AddDropdown({
	Name = "Select Player",
	Default = "No players found",
	Values = UpdatePlayers(),
	Callback = function(selectedName)
		CurrentTarget = selectedName
	end,
});

GeneralSection:AddButton({
	Name = "Teleport to Player",
	Callback = function()
		if not CurrentTarget or CurrentTarget == "No players found" then
			Notifier.new({
				Title = "Teleport Error",
				Content = "No valid player selected.",
				Duration = 5,
				Icon = "error"
			});
			return
		end

		local targetPlayer = Players:FindFirstChild(CurrentTarget)
		local localPlayer = Players.LocalPlayer
		
		if targetPlayer and targetPlayer.Character and localPlayer.Character and localPlayer.Character:FindFirstChild("HumanoidRootPart") then
			local targetPosition = targetPlayer.Character:FindFirstChild("HumanoidRootPart").CFrame
			local hrp = localPlayer.Character.HumanoidRootPart
			local TweenService = game:GetService("TweenService")
			
			local tweenInfo = TweenInfo.new(
				CurrentTweenSpeed,
				Enum.EasingStyle.Linear,
				Enum.EasingDirection.Out,
				0,
				false,
				0
			)
			
			local properties = {CFrame = targetPosition * CFrame.new(0, 3, 0)}
			local tween = TweenService:Create(hrp, tweenInfo, properties)
			
			tween:Play()
			
			Notifier.new({
				Title = "Teleport Success",
				Content = "Teleported to " .. CurrentTarget .. " with time " .. string.format("%.2f", CurrentTweenSpeed) .. "s",
				Duration = 3,
				Icon = "rbxassetid://72788619889737"
			});
		else
			Notifier.new({
				Title = "Teleport Error",
				Content = "Target player or character not found.",
				Duration = 5,
				Icon = "error"
			});
		end
	end,
});

GeneralSection:AddButton({
	Name = "Update Player List",
	Callback = function()
		UpdatePlayers()
		Notifier.new({
			Title = "Update Complete",
			Content = "Player list has been updated.",
			Duration = 3,
			Icon = "refresh"
		});
	end,
});


local ContainerTab = Window:DrawContainerTab({
	Name = "Extract Tabs",
	Icon = "contact",
});

local ExtractTab = ContainerTab:DrawTab({
	Name = "Tab 1",
	Type = "Double"
});

local SingleExtractTab = ContainerTab:DrawTab({
	Name = "Tab 2",
	Type = "Single",
	EnableScrolling = true,
});


Window:DrawCategory({
	Name = "Misc"
});

local SettingTab = Window:DrawTab({
	Icon = "settings-3",
	Name = "Settings",
	Type = "Single",
	EnableScrolling = true
});

local ThemeTab = Window:DrawTab({
	Icon = "paintbrush",
	Name = "Themes",
	Type = "Single"
});

local Settings = SettingTab:DrawSection({
	Name = "UI Settings",
});

Settings:AddToggle({
	Name = "Alway Show Frame",
	Default = false,
	Callback = function(v)
		Window.AlwayShowTab = v;
	end,
});

Settings:AddColorPicker({
	Name = "Highlight",
	Default = Compkiller.Colors.Highlight,
	Callback = function(v)
		Compkiller.Colors.Highlight = v;
		Compkiller:RefreshCurrentColor();
	end,
});

Settings:AddColorPicker({
	Name = "Toggle Color",
	Default = Compkiller.Colors.Toggle,
	Callback = function(v)
		Compkiller.Colors.Toggle = v;
		
		Compkiller:RefreshCurrentColor(v);
	end,
});

Settings:AddColorPicker({
	Name = "Drop Color",
	Default = Compkiller.Colors.DropColor,
	Callback = function(v)
		Compkiller.Colors.DropColor = v;

		Compkiller:RefreshCurrentColor(v);
	end,
});

Settings:AddColorPicker({
	Name = "Risky",
	Default = Compkiller.Colors.Risky,
	Callback = function(v)
		Compkiller.Colors.Risky = v;

		Compkiller:RefreshCurrentColor(v);
	end,
});

Settings:AddColorPicker({
	Name = "Mouse Enter",
	Default = Compkiller.Colors.MouseEnter,
	Callback = function(v)
		Compkiller.Colors.MouseEnter = v;

		Compkiller:RefreshCurrentColor(v);
	end,
});

Settings:AddColorPicker({
	Name = "Block Color",
	Default = Compkiller.Colors.BlockColor,
	Callback = function(v)
		Compkiller.Colors.BlockColor = v;

		Compkiller:RefreshCurrentColor(v);
	end,
});

Settings:AddColorPicker({
	Name = "Background Color",
	Default = Compkiller.Colors.BGDBColor,
	Callback = function(v)
		Compkiller.Colors.BGDBColor = v;

		Compkiller:RefreshCurrentColor(v);
	end,
});

Settings:AddColorPicker({
	Name = "Block Background Color",
	Default = Compkiller.Colors.BlockBackground,
	Callback = function(v)
		Compkiller.Colors.BlockBackground = v;

		Compkiller:RefreshCurrentColor(v);
	end,
});

Settings:AddColorPicker({
	Name = "Stroke Color",
	Default = Compkiller.Colors.StrokeColor,
	Callback = function(v)
		Compkiller.Colors.StrokeColor = v;

		Compkiller:RefreshCurrentColor(v);
	end,
});

Settings:AddColorPicker({
	Name = "High Stroke Color",
	Default = Compkiller.Colors.HighStrokeColor,
	Callback = function(v)
		Compkiller.Colors.HighStrokeColor = v;

		Compkiller:RefreshCurrentColor(v);
	end,
});

Settings:AddColorPicker({
	Name = "Switch Color",
	Default = Compkiller.Colors.SwitchColor,
	Callback = function(v)
		Compkiller.Colors.SwitchColor = v;

		Compkiller:RefreshCurrentColor(v);
	end,
});

Settings:AddColorPicker({
	Name = "Line Color",
	Default = Compkiller.Colors.LineColor,
	Callback = function(v)
		Compkiller.Colors.LineColor = v;

		Compkiller:RefreshCurrentColor(v);
	end,
});

Settings:AddButton({
	Name = "Get Theme",
	Callback = function()
		print(Compkiller:GetTheme())
		
		Notifier.new({
			Title = "Notification",
			Content = "Copied Them Color to your clipboard",
			Duration = 5,
			Icon = "rbxassetid://72788619889737"
		});
	end,
});

ThemeTab:DrawSection({
	Name = "UI Themes"
}):AddDropdown({
	Name = "Select Theme",
	Default = "Default",
	Values = {
		"Default",
		"Dark Green",
		"Dark Blue",
		"Purple Rose",
		"Skeet"
	},
	Callback = function(v)
		Compkiller:SetTheme(v)
	end,
})
