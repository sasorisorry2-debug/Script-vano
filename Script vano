local redzlib = loadstring(game:HttpGet("https://raw.githubusercontent.com/tbao143/Library-ui/refs/heads/main/Redzhubui"))()

local Window = redzlib:MakeWindow({
  Title = "RS-HOME",
  SubTitle = "RS-vano",
  SaveFolder = "testando | redz lib v5.lua"
})

Window:AddMinimizeButton({
    Button = { 
        Image = "rbxassetid://72788619889737", 
        BackgroundTransparency = 0,
        Size = UDim2.new(0, 40, 0, 40)
    },
    Corner = { 
        CornerRadius = UDim.new(0, 8)
    },
})

local Tab_Main = Window:MakeTab({"Main", "home"}) 
local Tab_Visual = Window:MakeTab({"Visual", "eye"}) 

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local Camera = workspace.CurrentCamera
local LocalPlayer = Players.LocalPlayer

local COLOR_BOX = Color3.fromRGB(255, 0, 0)
local COLOR_NAME = Color3.fromRGB(255, 255, 255)
local COLOR_TRACER = Color3.fromRGB(255, 0, 0)
local COLOR_INFO_TEXT = Color3.fromRGB(0, 255, 0)
local COLOR_FRIEND = Color3.fromRGB(0, 0, 255)
local COLOR_ENEMY = Color3.fromRGB(255, 0, 0)

local function getHealthColor(healthPercent)
    if healthPercent > 0.7 then
        return Color3.fromRGB(0, 255, 0)
    elseif healthPercent > 0.3 then
        return Color3.fromRGB(255, 165, 0)
    else
        return Color3.fromRGB(255, 0, 0)
    end
end

ESP = ESP or {
    Enabled = false,
    ShowBoxes = false,
    ShowNames = false,
    ShowTracers = false,
    ShowHealth = false,
    ShowDistance = false,
    ShowHealthPercent = false,
    ShowPlayerState = false,
    ShowOutline = false,
    UseTeamColor = true,
    HealthColorMode = "gradient",
    HealthColorFunction = getHealthColor
}

local ESPObjects = {}
local Highlights = {}

local function newDrawing(type, props)
    local obj = Drawing.new(type)
    for k, v in pairs(props) do
        obj[k] = v
    end
    return obj
end

local function createESPElements()
    return {
        Box = newDrawing("Square", {Visible = false, Thickness = 3, Filled = false, Color = COLOR_BOX}),
        Name = newDrawing("Text", {Visible = false, Center = true, Outline = true, Size = 16, Font = 2, Color = COLOR_NAME}),
        Tracer = newDrawing("Line", {Visible = false, Thickness = 1, Color = COLOR_TRACER}),
        HealthBar = newDrawing("Line", {Visible = false, Thickness = 5, Color = Color3.fromRGB(0, 255, 0)}),
        InfoText = newDrawing("Text", {Visible = false, Center = true, Outline = true, Size = 14, Font = 2, Color = COLOR_INFO_TEXT}) 
    }
end

local function getBoxScreenPoints(cframe, size)
    local half = size / 2
    local points = {}
    local visible = true
    for x = -1,1,2 do
        for y = -1,1,2 do
            for z = -1,1,2 do
                local corner = cframe * Vector3.new(half.X*x, half.Y*y, half.Z*z)
                local screenPos, onScreen = Camera:WorldToViewportPoint(corner)
                if not onScreen then visible = false end
                table.insert(points, Vector2.new(screenPos.X, screenPos.Y))
            end
        end
    end
    return points, visible
end

local function hideAll(data)
    data.Box.Visible = false
    data.Name.Visible = false
    data.Tracer.Visible = false
    data.HealthBar.Visible = false
    data.InfoText.Visible = false
end

local function cleanupHighlight(player)
    local highlight = Highlights[player]
    if highlight and highlight.Parent then
        highlight:Destroy()
    end
    Highlights[player] = nil
end

local function updateHighlight(player, character)
    local highlight = Highlights[player]
    if not highlight then
        highlight = Instance.new("Highlight")
        highlight.RobloxLocked = true
        highlight.Name = "OutlineESP"
        highlight.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop
        highlight.Parent = character
        Highlights[player] = highlight
    end
    
    highlight.Adornee = character
    highlight.Enabled = ESP.Enabled and ESP.ShowOutline

    if highlight.Enabled then
        local targetColor
        if ESP.UseTeamColor then
            targetColor = player.TeamColor.Color
        else
            if player.Team == LocalPlayer.Team then
                targetColor = COLOR_FRIEND
            else
                targetColor = COLOR_ENEMY
            end
        end
        highlight.FillColor = targetColor
    end
end

RunService.RenderStepped:Connect(function()
    local isEnabled = ESP.Enabled

    if not isEnabled then
        for _, data in pairs(ESPObjects) do
            hideAll(data)
        end
    end

    local screenCenter = Vector2.new(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y)
    local baseColor = COLOR_BOX

    for _, player in ipairs(Players:GetPlayers()) do
        if player ~= LocalPlayer then
            local character = player.Character
            local humanoid = character and character:FindFirstChildOfClass("Humanoid")
            local rootPart = character and character:FindFirstChild("HumanoidRootPart")

            if isEnabled and character and humanoid and humanoid.Health > 0 and rootPart then
                
                if ESP.ShowOutline then
                    updateHighlight(player, character)
                else
                    cleanupHighlight(player)
                end

                local success, cframe, size = pcall(character.GetBoundingBox, character)
                if success and cframe and size then
                    local points, visible = getBoxScreenPoints(cframe, size)
                    if not visible then
                        if ESPObjects[player] then
                            hideAll(ESPObjects[player])
                        end
                    else
                        local data = ESPObjects[player] or createESPElements()
                        ESPObjects[player] = data

                        local minX, minY, maxX, maxY = math.huge, math.huge, -math.huge, -math.huge
                        for _, pt in ipairs(points) do
                            minX = math.min(minX, pt.X)
                            minY = math.min(minY, pt.Y)
                            maxX = math.max(maxX, pt.X)
                            maxY = math.max(maxY, pt.Y)
                        end

                        local boxWidth, boxHeight = maxX - minX, maxY - minY
                        local slimWidth = boxWidth * 0.7
                        local slimX = minX + (boxWidth - slimWidth) / 2
                        local healthRatio = math.clamp(humanoid.Health / humanoid.MaxHealth, 0, 1)

                        local localRoot = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
                        local distance = "∞"
                        if localRoot and rootPart then
                            distance = math.floor((localRoot.Position - rootPart.Position).Magnitude) .. "m"
                        end
                        
                        local healthPercent = math.floor(humanoid.Health / humanoid.MaxHealth * 100)
                        local playerState = humanoid.Health > 0 and "Alive" or "Dead"

                        if ESP.ShowBoxes then
                            data.Box.Visible = true
                            data.Box.Position = Vector2.new(slimX, minY)
                            data.Box.Size = Vector2.new(slimWidth, boxHeight)
                            data.Box.Color = baseColor
                        else
                            data.Box.Visible = false
                        end

                        if ESP.ShowNames then
                            data.Name.Visible = true
                            data.Name.Text = player.Name
                            data.Name.Position = Vector2.new(slimX + slimWidth/2, minY - 20)
                            data.Name.Color = COLOR_NAME
                        else
                            data.Name.Visible = false
                        end

                        if ESP.ShowTracers then
                            data.Tracer.Visible = true
                            data.Tracer.From = screenCenter
                            data.Tracer.To = Vector2.new(slimX + slimWidth/2, maxY)
                            data.Tracer.Color = baseColor
                        else
                            data.Tracer.Visible = false
                        end

                        if ESP.ShowHealth then
                            local barHeight = boxHeight * healthRatio
                            data.HealthBar.Visible = true
                            
                            if ESP.HealthColorMode == "gradient" and ESP.HealthColorFunction then
                                data.HealthBar.Color = ESP.HealthColorFunction(healthRatio)
                            end
                            
                            data.HealthBar.From = Vector2.new(slimX - 6, maxY)
                            data.HealthBar.To = Vector2.new(slimX - 6, maxY - barHeight)
                        else
                            data.HealthBar.Visible = false
                        end

                        local infoParts = {}
                        
                        if ESP.ShowDistance then
                            table.insert(infoParts, distance)
                        end
                        if ESP.ShowHealthPercent then
                            table.insert(infoParts, string.format("%d%%", healthPercent))
                        end
                        if ESP.ShowPlayerState then
                            table.insert(infoParts, playerState)
                        end

                        if #infoParts > 0 then
                            data.InfoText.Visible = true
                            data.InfoText.Text = table.concat(infoParts, " | ")
                            data.InfoText.Position = Vector2.new(slimX + slimWidth/2, maxY + 10) 
                            data.InfoText.Color = COLOR_INFO_TEXT
                        else
                            data.InfoText.Visible = false
                        end
                    end
                end
            else
                if ESPObjects[player] then
                    hideAll(ESPObjects[player])
                end
                cleanupHighlight(player)
            end
        else
            cleanupHighlight(player)
        end
    end
end)

Players.PlayerRemoving:Connect(function(player)
    if ESPObjects[player] then
        for _, obj in pairs(ESPObjects[player]) do
            obj:Remove()
        end
        ESPObjects[player] = nil
    end
    cleanupHighlight(player)
end)

Tab_Visual:AddSection({"ESP Global"})

Tab_Visual:AddToggle({
    Name = "ESP Включить",
    Default = false,
    Callback = function(Value)
        ESP.Enabled = Value
    end
})

Tab_Visual:AddSection({"Визуальные элементы"})

Tab_Visual:AddToggle({
    Name = "ESP Обводка (Outline)",
    Default = false,
    Callback = function(Value)
        ESP.ShowOutline = Value
    end
})

Tab_Visual:AddToggle({
    Name = "Показывать Боксы (Box)",
    Default = false,
    Callback = function(Value)
        ESP.ShowBoxes = Value
    end
})

Tab_Visual:AddToggle({
    Name = "Показывать Трассеры",
    Default = false,
    Callback = function(Value)
        ESP.ShowTracers = Value
    end
})

Tab_Visual:AddToggle({
    Name = "Показывать Полосу Здоровья",
    Default = false,
    Callback = function(Value)
        ESP.ShowHealth = Value
    end
})

Tab_Visual:AddSection({"Отображение Информации (Текст)"})

Tab_Visual:AddToggle({
    Name = "Имена Игроков",
    Default = false,
    Callback = function(Value)
        ESP.ShowNames = Value
    end
})

Tab_Visual:AddToggle({
    Name = "Дистанция",
    Default = false,
    Callback = function(Value)
        ESP.ShowDistance = Value
    end
})

Tab_Visual:AddToggle({
    Name = "Здоровье в %",
    Default = false,
    Callback = function(Value)
        ESP.ShowHealthPercent = Value
    end
})

Tab_Visual:AddToggle({
    Name = "Состояние (Alive/Dead)",
    Default = false,
    Callback = function(Value)
        ESP.ShowPlayerState = Value
    end
})

Tab_Visual:AddSection({"Обводка (Outline)"})

Tab_Visual:AddToggle({
    Name = "Цвет Обводки по Команде",
    Default = ESP.UseTeamColor,
    Callback = function(Value)
        ESP.UseTeamColor = Value
    end
})

redzlib:SetTheme("Purple")
