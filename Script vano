local Compkiller = loadstring(game:HttpGet("https://raw.githubusercontent.com/4lpaca-pin/CompKiller/refs/heads/main/src/source.luau"))();

local UserInputService = game:GetService("UserInputService")
local Players = game:GetService("Players")
local InfiniteJumpEnabled = false
local SpeedEnabled = false 

UserInputService.JumpRequest:Connect(function()
	if InfiniteJumpEnabled then
		local Character = Players.LocalPlayer.Character
		local Humanoid = Character and Character:FindFirstChildOfClass('Humanoid')
		
		if Humanoid then
			Humanoid:ChangeState(Enum.HumanoidStateType.Jumping)
		end
	end
end)

local Notifier = Compkiller.newNotify();

Compkiller:Loader("rbxassetid://72788619889737" , 2.5).yield();

local Window = Compkiller.new({
	Name = "VANO-HUB",
	Keybind = "LeftAlt",
	Logo = "rbxassetid://72788619889737",
	Scale = Compkiller.Scale.Window,
	TextSize = 15,
});

Notifier.new({
	Title = "Welcome",
	Content = "Welcome rshome",
	Duration = 10,
	Icon = "rbxassetid://72788619889737"
});

local Watermark = Window:Watermark();

Watermark:AddText({
	Icon = "user",
	Text = "RShome",
});

Watermark:AddText({
	Icon = "clock",
	Text = Compkiller:GetDate(),
});

local Time = Watermark:AddText({
	Icon = "timer",
	Text = "TIME",
});

task.spawn(function()
	while true do task.wait()
		Time:SetText(Compkiller:GetTimeNow());
	end
end)

Watermark:AddText({
	Icon = "server",
	Text = Compkiller.Version,
});

Window:DrawCategory({
	Name = "Example"
});

local NormalTab = Window:DrawTab({
	Name = "Main",
	Icon = "sword",
	EnableScrolling = true
});

local NormalSection = NormalTab:DrawSection({
	Name = "Section (Left)",
	Position = 'left'	
});

NormalSection:AddToggle({
	Name = "Infinite Jump",
	Default = false,
	Callback = function(v)
		InfiniteJumpEnabled = v
	end,
});

local SpeedSlider
NormalSection:AddToggle({
	Name = "Speed",
	Default = false,
	Callback = function(v)
		SpeedEnabled = v
		
		local Player = Players.LocalPlayer
		local Humanoid = Player and Player.Character and Player.Character:FindFirstChildOfClass('Humanoid')
		
		if Humanoid then
			local targetSpeed = v and SpeedSlider:GetValue() or 16
			sethiddenproperty(Humanoid, "WalkSpeed", targetSpeed)
		end
	end,
});

SpeedSlider = NormalSection:AddSlider({
	Name = "WalkSpeed Value",
	Min = 16,
	Max = 300,
	Default = 50, 
	Step = 1,
	Unit = "WalkSpeed",
	Callback = function(v)
		if SpeedEnabled then
			local Player = Players.LocalPlayer
			local Humanoid = Player and Player.Character and Player.Character:FindFirstChildOfClass('Humanoid')
			
			if Humanoid then
				sethiddenproperty(Humanoid, "WalkSpeed", v)
			end
		end
	end
});

--- Fly V3 Button
NormalSection:AddButton({
	Name = "Fly V3 (Open GUI)",
	Callback = function()
		-- Ваш функционал Fly V3
		local main = Instance.new("ScreenGui")
		local Frame = Instance.new("Frame")
		local up = Instance.new("TextButton")
		local down = Instance.new("TextButton")
		local onof = Instance.new("TextButton")
		local TextLabel = Instance.new("TextLabel")
		local plus = Instance.new("TextButton")
		local speed = Instance.new("TextLabel")
		local mine = Instance.new("TextButton")
		local closebutton = Instance.new("TextButton")
		local mini = Instance.new("TextButton")
		local mini2 = Instance.new("TextButton")

		main.Name = "main"
		main.Parent = game.Players.LocalPlayer:WaitForChild("PlayerGui")
		main.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
		main.ResetOnSpawn = false

		Frame.Parent = main
		Frame.BackgroundColor3 = Color3.fromRGB(163, 255, 137)
		Frame.BorderColor3 = Color3.fromRGB(103, 221, 213)
		Frame.Position = UDim2.new(0.100320168, 0, 0.379746825, 0)
		Frame.Size = UDim2.new(0, 190, 0, 57)

		up.Name = "up"
		up.Parent = Frame
		up.BackgroundColor3 = Color3.fromRGB(79, 255, 152)
		up.Size = UDim2.new(0, 44, 0, 28)
		up.Font = Enum.Font.SourceSans
		up.Text = "UP"
		up.TextColor3 = Color3.fromRGB(0, 0, 0)
		up.TextSize = 14.000

		down.Name = "down"
		down.Parent = Frame
		down.BackgroundColor3 = Color3.fromRGB(215, 255, 121)
		down.Position = UDim2.new(0, 0, 0.491228074, 0)
		down.Size = UDim2.new(0, 44, 0, 28)
		down.Font = Enum.Font.SourceSans
		down.Text = "DOWN"
		down.TextColor3 = Color3.fromRGB(0, 0, 0)
		down.TextSize = 14.000

		onof.Name = "onof"
		onof.Parent = Frame
		onof.BackgroundColor3 = Color3.fromRGB(255, 249, 74)
		onof.Position = UDim2.new(0.702823281, 0, 0.491228074, 0)
		onof.Size = UDim2.new(0, 56, 0, 28)
		onof.Font = Enum.Font.SourceSans
		onof.Text = "fly"
		onof.TextColor3 = Color3.fromRGB(0, 0, 0)
		onof.TextSize = 14.000

		TextLabel.Parent = Frame
		TextLabel.BackgroundColor3 = Color3.fromRGB(242, 60, 255)
		TextLabel.Position = UDim2.new(0.469327301, 0, 0, 0)
		TextLabel.Size = UDim2.new(0, 100, 0, 28)
		TextLabel.Font = Enum.Font.SourceSans
		TextLabel.Text = "FLY GUI V3"
		TextLabel.TextColor3 = Color3.fromRGB(0, 0, 0)
		TextLabel.TextScaled = true
		TextLabel.TextSize = 14.000
		TextLabel.TextWrapped = true

		plus.Name = "plus"
		plus.Parent = Frame
		plus.BackgroundColor3 = Color3.fromRGB(133, 145, 255)
		plus.Position = UDim2.new(0.231578946, 0, 0, 0)
		plus.Size = UDim2.new(0, 45, 0, 28)
		plus.Font = Enum.Font.SourceSans
		plus.Text = "+"
		plus.TextColor3 = Color3.fromRGB(0, 0, 0)
		plus.TextScaled = true
		plus.TextSize = 14.000
		plus.TextWrapped = true

		speed.Name = "speed"
		speed.Parent = Frame
		speed.BackgroundColor3 = Color3.fromRGB(255, 85, 0)
		speed.Position = UDim2.new(0.468421042, 0, 0.491228074, 0)
		speed.Size = UDim2.new(0, 44, 0, 28)
		speed.Font = Enum.Font.SourceSans
		speed.Text = "1"
		speed.TextColor3 = Color3.fromRGB(0, 0, 0)
		speed.TextScaled = true
		speed.TextSize = 14.000
		speed.TextWrapped = true

		mine.Name = "mine"
		mine.Parent = Frame
		mine.BackgroundColor3 = Color3.fromRGB(123, 255, 247)
		mine.Position = UDim2.new(0.231578946, 0, 0.491228074, 0)
		mine.Size = UDim2.new(0, 45, 0, 29)
		mine.Font = Enum.Font.SourceSans
		mine.Text = "-"
		mine.TextColor3 = Color3.fromRGB(0, 0, 0)
		mine.TextScaled = true
		mine.TextSize = 14.000
		mine.TextWrapped = true

		closebutton.Name = "Close"
		closebutton.Parent = main.Frame
		closebutton.BackgroundColor3 = Color3.fromRGB(225, 25, 0)
		closebutton.Font = "SourceSans"
		closebutton.Size = UDim2.new(0, 45, 0, 28)
		closebutton.Text = "X"
		closebutton.TextSize = 30
		closebutton.Position =  UDim2.new(0, 0, -1, 27)

		mini.Name = "minimize"
		mini.Parent = main.Frame
		mini.BackgroundColor3 = Color3.fromRGB(192, 150, 230)
		mini.Font = "SourceSans"
		mini.Size = UDim2.new(0, 45, 0, 28)
		mini.Text = "-"
		mini.TextSize = 40
		mini.Position = UDim2.new(0, 44, -1, 27)

		mini2.Name = "minimize2"
		mini2.Parent = main.Frame
		mini2.BackgroundColor3 = Color3.fromRGB(192, 150, 230)
		mini2.Font = "SourceSans"
		mini2.Size = UDim2.new(0, 45, 0, 28)
		mini2.Text = "+"
		mini2.TextSize = 40
		mini2.Position = UDim2.new(0, 44, -1, 57)
		mini2.Visible = false

		local speeds = 1

		local speaker = game:GetService("Players").LocalPlayer

		local chr = game.Players.LocalPlayer.Character
		local hum = chr and chr:FindFirstChildWhichIsA("Humanoid")

		local nowe = false
		local tpwalking = false -- Инициализация tpwalking здесь

		game:GetService("StarterGui"):SetCore("SendNotification", { 
			Title = "FLY GUI V3";
			Text = "BY XNEO";
			Icon = "rbxthumb://type=Asset&id=5107182114&w=150&h=150";
			Duration = 5;
		})

		Frame.Active = true -- main = gui
		Frame.Draggable = true

		onof.MouseButton1Down:connect(function()

			if nowe == true then
				nowe = false
				tpwalking = false -- Отключаем цикл телепортации
				
				local Char = speaker.Character
				if Char and Char:FindFirstChildOfClass("Humanoid") then
					Char.Humanoid:SetStateEnabled(Enum.HumanoidStateType.Climbing,true)
					Char.Humanoid:SetStateEnabled(Enum.HumanoidStateType.FallingDown,true)
					Char.Humanoid:SetStateEnabled(Enum.HumanoidStateType.Flying,true)
					Char.Humanoid:SetStateEnabled(Enum.HumanoidStateType.Freefall,true)
					Char.Humanoid:SetStateEnabled(Enum.HumanoidStateType.GettingUp,true)
					Char.Humanoid:SetStateEnabled(Enum.HumanoidStateType.Jumping,true)
					Char.Humanoid:SetStateEnabled(Enum.HumanoidStateType.Landed,true)
					Char.Humanoid:SetStateEnabled(Enum.HumanoidStateType.Physics,true)
					Char.Humanoid:SetStateEnabled(Enum.HumanoidStateType.PlatformStanding,true)
					Char.Humanoid:SetStateEnabled(Enum.HumanoidStateType.Ragdoll,true)
					Char.Humanoid:SetStateEnabled(Enum.HumanoidStateType.Running,true)
					Char.Humanoid:SetStateEnabled(Enum.HumanoidStateType.RunningNoPhysics,true)
					Char.Humanoid:SetStateEnabled(Enum.HumanoidStateType.Seated,true)
					Char.Humanoid:SetStateEnabled(Enum.HumanoidStateType.StrafingNoPhysics,true)
					Char.Humanoid:SetStateEnabled(Enum.HumanoidStateType.Swimming,true)
					Char.Humanoid:ChangeState(Enum.HumanoidStateType.RunningNoPhysics)
				end

			else 
				nowe = true
				
				-- Цикл для телепортации вперед
				for i = 1, speeds do
					task.spawn(function()
						local hb = game:GetService("RunService").Heartbeat	
						tpwalking = true
						local chr = game.Players.LocalPlayer.Character
						local hum = chr and chr:FindFirstChildWhichIsA("Humanoid")
						while tpwalking and hb:Wait() and chr and hum and hum.Parent and nowe do -- Проверка nowe для остановки
							if hum.MoveDirection.Magnitude > 0 then
								chr:TranslateBy(hum.MoveDirection)
							end
						end
					end)
				end
				
				local Char = game.Players.LocalPlayer.Character
				if Char then
					Char.Animate.Disabled = true
					
					local Hum = Char:FindFirstChildOfClass("Humanoid") or Char:FindFirstChildOfClass("AnimationController")
					if Hum then
						for i,v in next, Hum:GetPlayingAnimationTracks() do
							v:AdjustSpeed(0)
						end
						
						Char.Humanoid:SetStateEnabled(Enum.HumanoidStateType.Climbing,false)
						Char.Humanoid:SetStateEnabled(Enum.HumanoidStateType.FallingDown,false)
						Char.Humanoid:SetStateEnabled(Enum.HumanoidStateType.Flying,false)
						Char.Humanoid:SetStateEnabled(Enum.HumanoidStateType.Freefall,false)
						Char.Humanoid:SetStateEnabled(Enum.HumanoidStateType.GettingUp,false)
						Char.Humanoid:SetStateEnabled(Enum.HumanoidStateType.Jumping,false)
						Char.Humanoid:SetStateEnabled(Enum.HumanoidStateType.Landed,false)
						Char.Humanoid:SetStateEnabled(Enum.HumanoidStateType.Physics,false)
						Char.Humanoid:SetStateEnabled(Enum.HumanoidStateType.PlatformStanding,false)
						Char.Humanoid:SetStateEnabled(Enum.HumanoidStateType.Ragdoll,false)
						Char.Humanoid:SetStateEnabled(Enum.HumanoidStateType.Running,false)
						Char.Humanoid:SetStateEnabled(Enum.HumanoidStateType.RunningNoPhysics,false)
						Char.Humanoid:SetStateEnabled(Enum.HumanoidStateType.Seated,false)
						Char.Humanoid:SetStateEnabled(Enum.HumanoidStateType.StrafingNoPhysics,false)
						Char.Humanoid:SetStateEnabled(Enum.HumanoidStateType.Swimming,false)
						Char.Humanoid:ChangeState(Enum.HumanoidStateType.Swimming)
					end
				end

			end


			if nowe then
				local plr = game.Players.LocalPlayer
				local char = plr.Character
				if not char then return end

				local isR6 = char:FindFirstChildOfClass("Humanoid").RigType == Enum.HumanoidRigType.R6
				local targetPart = isR6 and char:FindFirstChild("Torso") or char:FindFirstChild("UpperTorso")
				
				if not targetPart then return end

				local ctrl = {f = 0, b = 0, l = 0, r = 0}
				local lastctrl = {f = 0, b = 0, l = 0, r = 0}
				local maxspeed = 50
				local currentSpeed = 0

				local bg = Instance.new("BodyGyro", targetPart)
				bg.P = 9e4
				bg.maxTorque = Vector3.new(9e9, 9e9, 9e9)
				bg.cframe = targetPart.CFrame
				local bv = Instance.new("BodyVelocity", targetPart)
				bv.velocity = Vector3.new(0,0.1,0)
				bv.maxForce = Vector3.new(9e9, 9e9, 9e9)
				
				plr.Character.Humanoid.PlatformStand = true
				
				local flyLoop = game:GetService("RunService").RenderStepped:Connect(function()
					if not nowe or plr.Character.Humanoid.Health == 0 then
						-- Очистка при выключении
						bg:Destroy()
						bv:Destroy()
						plr.Character.Humanoid.PlatformStand = false
						plr.Character.Animate.Disabled = false
						flyLoop:Disconnect()
						return
					end

					if ctrl.l + ctrl.r ~= 0 or ctrl.f + ctrl.b ~= 0 then
						currentSpeed = currentSpeed+.5+(currentSpeed/maxspeed)
						if currentSpeed > maxspeed then
							currentSpeed = maxspeed
						end
					elseif not (ctrl.l + ctrl.r ~= 0 or ctrl.f + ctrl.b ~= 0) and currentSpeed ~= 0 then
						currentSpeed = currentSpeed-1
						if currentSpeed < 0 then
							currentSpeed = 0
						end
					end
					
					local camCFrame = game.Workspace.CurrentCamera.CoordinateFrame
					local moveVector
					
					if (ctrl.l + ctrl.r) ~= 0 or (ctrl.f + ctrl.b) ~= 0 then
						moveVector = (camCFrame.lookVector * (ctrl.f+ctrl.b)) + ((camCFrame * CFrame.new(ctrl.l+ctrl.r,(ctrl.f+ctrl.b)*.2,0).p) - camCFrame.p)
						lastctrl = {f = ctrl.f, b = ctrl.b, l = ctrl.l, r = ctrl.r}
					elseif (ctrl.l + ctrl.r) == 0 and (ctrl.f + ctrl.b) == 0 and currentSpeed ~= 0 then
						moveVector = (camCFrame.lookVector * (lastctrl.f+lastctrl.b)) + ((camCFrame * CFrame.new(lastctrl.l+lastctrl.r,(lastctrl.f+lastctrl.b)*.2,0).p) - camCFrame.p)
					else
						bv.velocity = Vector3.new(0,0,0)
						return
					end
					
					bv.velocity = moveVector * currentSpeed
					bg.cframe = camCFrame * CFrame.Angles(-math.rad((ctrl.f+ctrl.b)*50*currentSpeed/maxspeed),0,0)
				end)
			end
			
		end)

		local tis
		up.MouseButton1Down:connect(function()
			tis = game:GetService("RunService").Heartbeat:Connect(function()
				if nowe and game.Players.LocalPlayer.Character and game.Players.LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
					game.Players.LocalPlayer.Character.HumanoidRootPart.CFrame = game.Players.LocalPlayer.Character.HumanoidRootPart.CFrame * CFrame.new(0,speeds,0)
				end
			end)
		end)

		up.MouseButton1Up:connect(function()
			if tis then
				tis:Disconnect()
				tis = nil
			end
		end)

		local dis
		down.MouseButton1Down:connect(function()
			dis = game:GetService("RunService").Heartbeat:Connect(function()
				if nowe and game.Players.LocalPlayer.Character and game.Players.LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
					game.Players.LocalPlayer.Character.HumanoidRootPart.CFrame = game.Players.LocalPlayer.Character.HumanoidRootPart.CFrame * CFrame.new(0,-speeds,0)
				end
			end)
		end)

		down.MouseButton1Up:connect(function()
			if dis then
				dis:Disconnect()
				dis = nil
			end
		end)


		game:GetService("Players").LocalPlayer.CharacterAdded:Connect(function(char)
			task.wait(0.7)
			local hum = char:FindFirstChildOfClass("Humanoid")
			if hum then
				hum.PlatformStand = false
			end
			char.Animate.Disabled = false
		end)


		plus.MouseButton1Down:connect(function()
			speeds = speeds + 1
			speed.Text = speeds
			if nowe == true then
				tpwalking = false
				task.wait(0.1) -- Небольшая задержка для завершения предыдущего цикла
				for i = 1, speeds do
					task.spawn(function()
						local hb = game:GetService("RunService").Heartbeat	
						tpwalking = true
						local chr = game.Players.LocalPlayer.Character
						local hum = chr and chr:FindFirstChildWhichIsA("Humanoid")
						while tpwalking and hb:Wait() and chr and hum and hum.Parent and nowe do
							if hum.MoveDirection.Magnitude > 0 then
								chr:TranslateBy(hum.MoveDirection)
							end
						end
					end)
				end
			end
		end)
		
		mine.MouseButton1Down:connect(function()
			if speeds == 1 then
				speed.Text = 'cannot be less than 1'
				task.wait(1)
				speed.Text = speeds
			else
				speeds = speeds - 1
				speed.Text = speeds
				if nowe == true then
					tpwalking = false
					task.wait(0.1) -- Небольшая задержка для завершения предыдущего цикла
					for i = 1, speeds do
						task.spawn(function()
							local hb = game:GetService("RunService").Heartbeat	
							tpwalking = true
							local chr = game.Players.LocalPlayer.Character
							local hum = chr and chr:FindFirstChildWhichIsA("Humanoid")
							while tpwalking and hb:Wait() and chr and hum and hum.Parent and nowe do
								if hum.MoveDirection.Magnitude > 0 then
									chr:TranslateBy(hum.MoveDirection)
								end
							end
						end)
					end
				end
			end
		end)

		closebutton.MouseButton1Click:Connect(function()
			-- Логика отключения при закрытии
			if nowe then
				onof.MouseButton1Down:Fire() -- Вызываем отключение Fly
			end
			main:Destroy()
		end)

		mini.MouseButton1Click:Connect(function()
			up.Visible = false
			down.Visible = false
			onof.Visible = false
			plus.Visible = false
			speed.Visible = false
			mine.Visible = false
			mini.Visible = false
			mini2.Visible = true
			main.Frame.BackgroundTransparency = 1
			closebutton.Position =  UDim2.new(0, 0, -1, 57)
		end)

		mini2.MouseButton1Click:Connect(function()
			up.Visible = true
			down.Visible = true
			onof.Visible = true
			plus.Visible = true
			speed.Visible = true
			mine.Visible = true
			mini.Visible = true
			mini2.Visible = false
			main.Frame.BackgroundTransparency = 0 
			closebutton.Position =  UDim2.new(0, 0, -1, 27)
		end)
	end,
});

local NormalSectionRight = NormalTab:DrawSection({
	Name = "Visual",
	Position = 'right'
});

-- == ESP FUNCTIONALITY START ==
local espConnections = {}
local espRun = nil
local Holder = nil

NormalSectionRight:AddToggle({
	Name = "ESP",
	Default = false,
	Callback = function(v)
		if v then
			-- Инициализация и запуск ESP
			
			-- Глобальные настройки цвета
			_G.FriendColor = Color3.fromRGB(0, 0, 255)
			_G.EnemyColor = Color3.fromRGB(255, 0, 0)
			_G.UseTeamColor = true

			Holder = Instance.new("Folder")
			Holder.Name = "VANO_ESP_Holder"
			Holder.Parent = game.CoreGui
			
			local Box = Instance.new("BoxHandleAdornment")
			Box.Name = "nilBox"
			Box.Size = Vector3.new(1, 2, 1)
			Box.Color3 = Color3.new(100 / 255, 100 / 255, 100 / 255)
			Box.Transparency = 0.7
			Box.ZIndex = 0
			Box.AlwaysOnTop = false
			Box.Visible = false

			local NameTag = Instance.new("BillboardGui")
			NameTag.Name = "nilNameTag"
			NameTag.Enabled = false
			NameTag.Size = UDim2.new(0, 200, 0, 50)
			NameTag.AlwaysOnTop = true
			NameTag.StudsOffset = Vector3.new(0, 1.8, 0)
			local Tag = Instance.new("TextLabel", NameTag)
			Tag.Name = "Tag"
			Tag.BackgroundTransparency = 1
			Tag.Position = UDim2.new(0, -50, 0, 0)
			Tag.Size = UDim2.new(0, 300, 0, 20)
			Tag.TextSize = 15
			Tag.TextColor3 = Color3.new(100 / 255, 100 / 255, 100 / 255)
			Tag.TextStrokeColor3 = Color3.new(0 / 255, 0 / 255, 0 / 255)
			Tag.TextStrokeTransparency = 0.4
			Tag.Text = "nil"
			Tag.Font = Enum.Font.SourceSansBold
			Tag.TextScaled = false

			local function UnloadCharacter(v)
				local vHolder = Holder:FindFirstChild(v.Name)
				if vHolder then
					vHolder:ClearAllChildren()
				end
			end
			
			local function LoadCharacter(v)
				repeat task.wait() until v.Character
				local Humanoid = v.Character:FindFirstChild("Humanoid")
				if not Humanoid then return UnloadCharacter(v) end
				
				local vHolder = Holder:FindFirstChild(v.Name) or Instance.new("Folder", Holder)
				vHolder.Name = v.Name
				vHolder:ClearAllChildren()
				
				local b = Box:Clone()
				b.Name = v.Name .. "Box"
				b.Adornee = v.Character
				b.Parent = vHolder
				
				local t = NameTag:Clone()
				t.Name = v.Name .. "NameTag"
				t.Enabled = true
				t.Parent = vHolder
				t.Adornee = v.Character:WaitForChild("Head", 5)
				if not t.Adornee then
					return UnloadCharacter(v)
				end
				
				t.Tag.Text = v.Name
				b.Color3 = v.TeamColor.Color
				t.Tag.TextColor3 = v.TeamColor.Color
				
				local Update = nil
				local function UpdateNameTag()
					if not v.Character or not v.Character:FindFirstChild("Humanoid") then
						if Update then Update:Disconnect() end
						return UnloadCharacter(v)
					end
					
					v.Character.Humanoid.DisplayDistanceType = Enum.HumanoidDisplayDistanceType.None
					-- Здесь можно добавить обновление текста HP
				end
				
				Update = Humanoid.Changed:Connect(UpdateNameTag)
				if espConnections[v.Name] then espConnections[v.Name]:Disconnect() end
				espConnections[v.Name] = Update
			end

			local function LoadPlayer(v)
				local vHolder = Holder:FindFirstChild(v.Name) or Instance.new("Folder", Holder)
				vHolder.Name = v.Name

				espConnections[v.Name .. "CharAdded"] = v.CharacterAdded:Connect(function() pcall(LoadCharacter, v) end)
				espConnections[v.Name .. "CharRemoving"] = v.CharacterRemoving:Connect(function() pcall(UnloadCharacter, v) end)
				espConnections[v.Name .. "TeamChanged"] = v.Changed:Connect(function(prop)
					if prop == "TeamColor" then
						UnloadCharacter(v)
						task.wait()
						LoadCharacter(v)
					end
				end)
				LoadCharacter(v)
			end

			local function UnloadPlayer(v)
				UnloadCharacter(v)
				local vHolder = Holder:FindFirstChild(v.Name)
				if vHolder then
					vHolder:Destroy()
				end
				for k, conn in pairs(espConnections) do
					if k:match(v.Name) then
						conn:Disconnect()
						espConnections[k] = nil
					end
				end
			end

			local function CleanupAll()
				for k, conn in pairs(espConnections) do
					conn:Disconnect()
				end
				espConnections = {}
				if Holder then
					Holder:Destroy()
					Holder = nil
				end
			end
			
			-- Запуск цикла и подключений
			for _, p in Players:GetPlayers() do
				if p ~= Players.LocalPlayer then
					task.spawn(function() pcall(LoadPlayer, p) end)
				end
			end

			espConnections["PlayerAdded"] = Players.PlayerAdded:Connect(function(p)
				if p ~= Players.LocalPlayer then
					pcall(LoadPlayer, p)
				end
			end)
			
			espConnections["PlayerRemoving"] = Players.PlayerRemoving:Connect(UnloadPlayer)
			
			Players.LocalPlayer.NameDisplayDistance = 0

			-- Дополнительная ESP, если не требуется, можно удалить
			local function highlightEsp(target, color)
				if target.Character then
					if not target.Character:FindFirstChild("VANO_Highlight") then
						local highlight = Instance.new("Highlight")
						highlight.RobloxLocked = true
						highlight.Name = "VANO_Highlight"
						highlight.Adornee = target.Character
						highlight.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop
						highlight.FillColor = color
						highlight.Parent = target.Character
					else
						target.Character.VANO_Highlight.FillColor = color
					end
				end
			end
			
			espRun = task.spawn(function()
				while task.wait() and v do -- Цикл для работы, пока тоггл включен
					local plr = Players.LocalPlayer
					for _, p in Players:GetPlayers() do
						if p ~= plr then
							local color = _G.UseTeamColor and p.TeamColor.Color or ((plr.TeamColor == p.TeamColor) and _G.FriendColor or _G.EnemyColor)
							highlightEsp(p, color)
						end
					end
				end
			end)
			
		else
			-- Отключение ESP
			if espRun then
				task.cancel(espRun)
				espRun = nil
			end
			
			-- Отключаем все коннекты и очищаем элементы
			for _, conn in pairs(espConnections) do
				conn:Disconnect()
			end
			espConnections = {}
			
			if Holder then
				Holder:Destroy()
				Holder = nil
			end

			-- Удаляем Highlight'ы
			local highlights = game.Workspace:GetDescendants()
			for _, obj in ipairs(highlights) do
				if obj.Name == "VANO_Highlight" and obj:IsA("Highlight") then
					obj:Destroy()
				end
			end
		end
	end,
});
-- == ESP FUNCTIONALITY END ==


local SingleTab = Window:DrawTab({
	Name = "General Tab",
	Icon = "fire",
	Type = "Single"
});

local ContainerTab = Window:DrawContainerTab({
	Name = "Extract Tabs",
	Icon = "contact",
});

local ExtractTab = ContainerTab:DrawTab({
	Name = "Tab 1",
	Type = "Double"
});

local SingleExtractTab = ContainerTab:DrawTab({
	Name = "Tab 2",
	Type = "Single",
	EnableScrolling = true,
});


Window:DrawCategory({
	Name = "Misc"
});

local SettingTab = Window:DrawTab({
	Icon = "settings-3",
	Name = "Settings",
	Type = "Single",
	EnableScrolling = true
});

local ThemeTab = Window:DrawTab({
	Icon = "paintbrush",
	Name = "Themes",
	Type = "Single"
});

local Settings = SettingTab:DrawSection({
	Name = "UI Settings",
});

Settings:AddToggle({
	Name = "Alway Show Frame",
	Default = false,
	Callback = function(v)
		Window.AlwayShowTab = v;
	end,
});

Settings:AddColorPicker({
	Name = "Highlight",
	Default = Compkiller.Colors.Highlight,
	Callback = function(v)
		Compkiller.Colors.Highlight = v;
		Compkiller:RefreshCurrentColor();
	end,
});

Settings:AddColorPicker({
	Name = "Toggle Color",
	Default = Compkiller.Colors.Toggle,
	Callback = function(v)
		Compkiller.Colors.Toggle = v;
		
		Compkiller:RefreshCurrentColor(v);
	end,
});

Settings:AddColorPicker({
	Name = "Drop Color",
	Default = Compkiller.Colors.DropColor,
	Callback = function(v)
		Compkiller.Colors.DropColor = v;

		Compkiller:RefreshCurrentColor(v);
	end,
});

Settings:AddColorPicker({
	Name = "Risky",
	Default = Compkiller.Colors.Risky,
	Callback = function(v)
		Compkiller.Colors.Risky = v;

		Compkiller:RefreshCurrentColor(v);
	end,
});

Settings:AddColorPicker({
	Name = "Mouse Enter",
	Default = Compkiller.Colors.MouseEnter,
	Callback = function(v)
		Compkiller.Colors.MouseEnter = v;

		Compkiller:RefreshCurrentColor(v);
	end,
});

Settings:AddColorPicker({
	Name = "Block Color",
	Default = Compkiller.Colors.BlockColor,
	Callback = function(v)
		Compkiller.Colors.BlockColor = v;

		Compkiller:RefreshCurrentColor(v);
	end,
});

Settings:AddColorPicker({
	Name = "Background Color",
	Default = Compkiller.Colors.BGDBColor,
	Callback = function(v)
		Compkiller.Colors.BGDBColor = v;

		Compkiller:RefreshCurrentColor(v);
	end,
});

Settings:AddColorPicker({
	Name = "Block Background Color",
	Default = Compkiller.Colors.BlockBackground,
	Callback = function(v)
		Compkiller.Colors.BlockBackground = v;

		Compkiller:RefreshCurrentColor(v);
	end,
});

Settings:AddColorPicker({
	Name = "Stroke Color",
	Default = Compkiller.Colors.StrokeColor,
	Callback = function(v)
		Compkiller.Colors.StrokeColor = v;

		Compkiller:RefreshCurrentColor(v);
	end,
});

Settings:AddColorPicker({
	Name = "High Stroke Color",
	Default = Compkiller.Colors.HighStrokeColor,
	Callback = function(v)
		Compkiller.Colors.HighStrokeColor = v;

		Compkiller:RefreshCurrentColor(v);
	end,
});

Settings:AddColorPicker({
	Name = "Switch Color",
	Default = Compkiller.Colors.SwitchColor,
	Callback = function(v)
		Compkiller.Colors.SwitchColor = v;

		Compkiller:RefreshCurrentColor(v);
	end,
});

Settings:AddColorPicker({
	Name = "Line Color",
	Default = Compkiller.Colors.LineColor,
	Callback = function(v)
		Compkiller.Colors.LineColor = v;

		Compkiller:RefreshCurrentColor(v);
	end,
});

Settings:AddButton({
	Name = "Get Theme",
	Callback = function()
		print(Compkiller:GetTheme())
		
		Notifier.new({
			Title = "Notification",
			Content = "Copied Them Color to your clipboard",
			Duration = 5,
			Icon = "rbxassetid://72788619889737"
		});
	end,
});

ThemeTab:DrawSection({
	Name = "UI Themes"
}):AddDropdown({
	Name = "Select Theme",
	Default = "Default",
	Values = {
		"Default",
		"Dark Green",
		"Dark Blue",
		"Purple Rose",
		"Skeet"
	},
	Callback = function(v)
		Compkiller:SetTheme(v)
	end,
})
